## üîê –ß—Ç–æ —Ç–∞–∫–æ–µ **CSP** (Content Security Policy)?

**CSP (Content Security Policy)** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π **HTTP-–∑–∞–≥–æ–ª–æ–≤–æ–∫**, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –±—Ä–∞—É–∑–µ—Ä—É, **–∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (JS, CSS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç.–ø.) –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ**, –∞ —á—Ç–æ **–∑–∞–ø—Ä–µ—â–µ–Ω–æ**.

–û–Ω **–ø–æ–º–æ–≥–∞–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –æ—Ç XSS** –∏ –¥—Ä—É–≥–∏—Ö –∞—Ç–∞–∫, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è:

* –æ—Ç–∫—É–¥–∞ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã, —Å—Ç–∏–ª–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è;
* –º–æ–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å inline-—Å–∫—Ä–∏–ø—Ç—ã (`<script> alert('xss') </script>`);
* –º–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `eval()` –∏ —Ç.–ø.

---

## üìå –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã CSP

–¢—ã –¥–æ–±–∞–≤–ª—è–µ—à—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Fastify) –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```ts
reply.header(
  'Content-Security-Policy',
  "default-src 'self'; script-src 'self'"
);
```

### –ß—Ç–æ –æ–Ω –∑–Ω–∞—á–∏—Ç:

* `default-src 'self'` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç **—Ç–æ–ª—å–∫–æ —Å —Ç–æ–≥–æ –∂–µ –¥–æ–º–µ–Ω–∞**.
* `script-src 'self'` ‚Äî **—Ç–æ–ª—å–∫–æ –Ω–∞—à–∏ JS-—Ñ–∞–π–ª—ã**, –Ω–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö CDN, inline-—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–ª–∏ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚ùå –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å –≤ HTML –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω—ã–π `<script>alert("XSS")</script>` ‚Äî **–±—Ä–∞—É–∑–µ—Ä –µ–≥–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç**, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ HTML!
‚úÖ –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω —Å —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`'self'`) –∏–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π `.js`-—Ñ–∞–π–ª.

---

## üìé –ü—Ä–∏–º–µ—Ä —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π inline-–∫–æ–¥–∞

–ï—Å–ª–∏ —Ç—ã –Ω–∞–ø–∏—à–µ—à—å CSP —Ç–∞–∫:

```ts
"script-src 'self'"
```

–ê –≤ HTML —É —Ç–µ–±—è –µ—Å—Ç—å:

```html
<script>
  console.log("Inline script");
</script>
```

‚Äî –±—Ä–∞—É–∑–µ—Ä **–∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç** —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω "—Å–≤–æ–π". –ü–æ—Ç–æ–º—É —á—Ç–æ inline –∑–∞–ø—Ä–µ—â—ë–Ω.

–ß—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å inline (–Ω–æ —ç—Ç–æ **–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ**, –æ—Å–æ–±–µ–Ω–Ω–æ –±–µ–∑ —Ö—ç—à–µ–π):

```ts
"script-src 'self' 'unsafe-inline'"
```

---

## üõ°Ô∏è –ü–æ—á–µ–º—É CSP –ø–æ–ª–µ–∑–µ–Ω:

‚úÖ –î–∞–∂–µ –µ—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –≤–¥—Ä—É–≥ –ø–æ—è–≤–∏—Ç—Å—è XSS (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫—Ç–æ-—Ç–æ –≤—Å—Ç–∞–≤–∏—Ç `<script>alert(1)</script>`) ‚Äî **CSP –Ω–µ –¥–∞—Å—Ç —ç—Ç–æ–º—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è**.
‚úÖ –≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞, **–¥–∞–∂–µ –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–¥–µ-—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ**.

---

## üß™ –ì–¥–µ –∏ –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

–í Fastify (backend):

```ts
app.addHook('onSend', (request, reply, payload, done) => {
  reply.header(
    'Content-Security-Policy',
    "default-src 'self'; script-src 'self'; style-src 'self'; connect-src 'self' ws:"
  );
  done();
});
```

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

* `connect-src 'self' ws:` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ–º WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
* `style-src 'self'` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–µ–≥–æ –¥–æ–º–µ–Ω–∞.
* `script-src 'self'` ‚Äî —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ JS.
* `default-src 'self'` ‚Äî –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ç–æ–∂–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ—ë.

---

## üìå –í–∞–∂–Ω–æ:

* CSP –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ **–≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã**.
* CSP –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ DevTools ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Network ‚Üí Headers**, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫.
* CSP –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –µ—â—ë –∂—ë—Å—Ç—á–µ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ —Å–∫—Ä–∏–ø—Ç—ã, —á–µ–π —Ö—ç—à –±—ã–ª —É–∫–∞–∑–∞–Ω.
